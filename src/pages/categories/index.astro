---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('posts', ({ data }) => data.draft !== true);

// 统计每个分类的文章数
const categoryCount = posts.reduce((acc, post) => {
	const category = post.data.category;
	acc[category] = (acc[category] || 0) + 1;
	return acc;
}, {} as Record<string, number>);

const categories = Object.entries(categoryCount).sort((a, b) => b[1] - a[1]);
---

<BaseLayout title="分类" description="按分类浏览文章">
	<h1>分类</h1>
	<ul class="category-list">
		{categories.map(([category, count]) => (
			<li>
				<a href={`/categories/${category}`}>
					<span class="name">{category}</span>
					<span class="count">{count}</span>
				</a>
			</li>
		))}
	</ul>
</BaseLayout>

<style>
	h1 {
		margin-bottom: 1.5em;
	}

	.category-list {
		list-style: none;
		padding: 0;
		margin: 0;
	}

	.category-list li {
		margin: 0;
	}

	.category-list a {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 1em 0;
		border-bottom: 1px solid rgb(var(--gray-light));
		text-decoration: none;
		color: rgb(var(--gray-dark));
		transition: color 0.2s;
	}

	.category-list a:hover {
		color: var(--accent);
	}

	.name {
		font-size: 1.1em;
	}

	.count {
		background: rgb(var(--gray-light));
		padding: 0.25em 0.75em;
		border-radius: 1em;
		font-size: 0.9em;
		color: rgb(var(--gray));
	}
</style>

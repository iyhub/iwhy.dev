---
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
	const posts = await getCollection('posts', ({ data }) => data.draft !== true);

	// 收集所有标签
	const allTags = new Set<string>();
	posts.forEach(post => {
		post.data.tags?.forEach(tag => allTags.add(tag));
	});

	return [...allTags].map(tag => ({
		params: { tag },
	}));
}

const { tag } = Astro.params;

// 重定向到分页第一页
return Astro.redirect(`/tags/${encodeURIComponent(tag)}/page/1`);
---
